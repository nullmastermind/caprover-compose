captainVersion: 4
caproverOneClickApp:
  displayName: Appwrite
  description: Appwrite is an open-source platform that helps you build apps faster and more securely with REST APIs.
  documentation: Taken from https://appwrite.io/docs
  instructions:
    start: |-
      Appwrite is a secure end-to-end backend server for Web, Mobile, and Flutter developers that is 
      packaged as a set of Docker containers. Appwrite abstracts the complexity and repetitiveness 
      required to build a modern backend API from scratch and allows you to build secure apps faster.
    end: |-
      Appwrite has been successfully deployed! 

      Important Next Steps:
      1. Enable WebSocket Support in the HTTP Settings by ticking "Websocket Support"
      2. Add the following to "Edit Default Nginx Configurations":

      ```nginx
      location /console {
          proxy_pass http://srv-captain--$$cap_appname-console:80;
      }

      location /v1/realtime {
          proxy_set_header Upgrade $http_upgrade;
          proxy_set_header Connection "upgrade";
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
          proxy_set_header Host $host;
          proxy_set_header X-Forwarded-Host $host;
          proxy_set_header X-Forwarded-Port $server_port;
          proxy_pass http://srv-captain--$$cap_appname-realtime;
          proxy_http_version 1.1;
          proxy_connect_timeout 7d;
          proxy_send_timeout 7d;
          proxy_read_timeout 7d;
      }
      ```

      3. Visit your Appwrite Console at https://$$cap_appname.$$cap_root_domain
      4. Create your first admin account

      Note: It may take a few minutes for all services to fully initialize.
  variables:
    - id: $$cap_appwrite_appwrite_version
      label: Appwrite Server Version
      defaultValue: 1.6.0
      description: Check out their Docker page for the valid tags https://hub.docker.com/r/appwrite/appwrite/tags
    - id: $$cap_app_env
      label: Environment Type
      defaultValue: production
      description: Set the environment type for Appwrite (production/development)
      validRegex: /^(production|development)$/
    - id: $$cap_app_worker_per_core
      label: Workers Per CPU Core
      defaultValue: "6"
      description: Number of workers to spawn per CPU core
      validRegex: /^[1-9][0-9]*$/
    - id: $$cap_app_locale
      label: Default System Locale
      defaultValue: en
      description: Default locale for the system
      validRegex: /^[a-z]{2}(-[A-Z]{2})?$/
    - id: $$cap_app_console_whitelist_root
      label: Root Access to Console
      defaultValue: enabled
      description: Enable or disable root access to the console
      validRegex: /^(enabled|disabled)$/
    - id: $$cap_app_console_whitelist_emails
      label: Whitelisted Console Emails
      description: Comma-separated list of emails allowed to access the console
      validRegex: /^$|^[^,]+(,[^,]+)*$/
    - id: $$cap_app_console_session_alerts
      label: Console Session Alerts
      defaultValue: disabled
      description: Enable or disable console session alerts
      validRegex: /^(enabled|disabled)$/
    - id: $$cap_app_console_whitelist_ips
      label: Whitelisted Console IPs
      description: Comma-separated list of IPs allowed to access the console
      validRegex: /^$|^[0-9./]+(,[0-9./]+)*$/
    - id: $$cap_app_console_hostnames
      label: Console Hostnames
      description: Comma-separated list of allowed console hostnames
      validRegex: /^$|^[^,]+(,[^,]+)*$/
    - id: $$cap_app_system_email_name
      label: System Email Sender Name
      defaultValue: Appwrite
      description: Name used for system-generated emails
    - id: $$cap_app_system_email_address
      label: System Email Address
      defaultValue: noreply@appwrite.io
      description: Email address used for system-generated emails
      validRegex: /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/
    - id: $$cap_app_email_security
      label: Email Security Mode
      defaultValue: tls
      description: Security mode for email transmission (tls/ssl/none)
      validRegex: /^(tls|ssl|none)$/
    - id: $$cap_app_system_response_format
      label: System Response Format
      defaultValue: json
      description: Default response format for API calls (json/xml)
      validRegex: /^(json|xml)$/
    - id: $$cap_app_options_abuse
      label: Abuse Protection
      defaultValue: enabled
      description: Enable or disable abuse protection
      validRegex: /^(enabled|disabled)$/
    - id: $$cap_app_options_router_protection
      label: Router Protection
      defaultValue: disabled
      description: Enable or disable router protection
      validRegex: /^(enabled|disabled)$/
    - id: $$cap_app_options_force_https
      label: Force HTTPS
      defaultValue: disabled
      description: Force all traffic over HTTPS
      validRegex: /^(enabled|disabled)$/
    - id: $$cap_app_options_functions_force_https
      label: Force HTTPS for Functions
      defaultValue: disabled
      description: Force all function calls over HTTPS
      validRegex: /^(enabled|disabled)$/
    - id: $$cap_app_openssl_key_v1
      label: OpenSSL Key
      defaultValue: $$cap_gen_random_hex(256)
      description: OpenSSL encryption key for sensitive data
    - id: $$cap_app_domain
      label: Application Domain
      defaultValue: localhost
      description: Primary domain for the application
    - id: $$cap_app_domain_target
      label: Domain Target
      defaultValue: localhost
      description: Target domain for the application
    - id: $$cap_app_domain_functions
      label: Functions Domain
      defaultValue: localhost
    - id: $$cap_app_redis_user
      label: Redis Username
      description: Username for Redis authentication
    - id: $$cap_app_redis_pass
      label: Redis Password
      description: Password for Redis authentication
    - id: $$cap_app_db_schema
      label: Database Schema Name
      defaultValue: appwrite
      description: Name of the database schema to use
    - id: $$cap_app_db_user
      label: Database Username
      defaultValue: appwrite
      description: Username for database authentication
    - id: $$cap_app_db_pass
      label: Database Password
      defaultValue: $$cap_gen_random_hex(32)
      description: Password for database authentication
    - id: $$cap_app_smtp_host
      label: SMTP Server Host
    - id: $$cap_app_smtp_port
      label: SMTP Server Port
    - id: $$cap_app_smtp_secure
      label: SMTP Security Type
    - id: $$cap_app_smtp_username
      label: SMTP Username
      defaultValue: root
    - id: $$cap_app_smtp_password
      label: SMTP Password
      defaultValue: $$cap_gen_random_hex(32)
    - id: $$cap_app_usage_stats
      label: Enable Usage Statistics
      defaultValue: enabled
    - id: $$cap_app_storage_limit
      label: Storage Limit (bytes)
      defaultValue: "30000000"
    - id: $$cap_app_storage_preview_limit
      label: Preview Storage Limit (bytes)
      defaultValue: "20000000"
    - id: $$cap_app_storage_antivirus
      label: Enable Antivirus
      defaultValue: disabled
    - id: $$cap_app_storage_antivirus_host
      label: Antivirus Host
      defaultValue: clamav
    - id: $$cap_app_storage_antivirus_port
      label: Antivirus Port
      defaultValue: "3310"
    - id: $$cap_app_storage_device
      label: Storage Device (local/s3/do/backblaze/linode/wasabi)
      defaultValue: local
    - id: $$cap_app_storage_s3_access_key
      label: AWS S3 Access Key
    - id: $$cap_app_storage_s3_secret
      label: AWS S3 Secret Key
    - id: $$cap_app_storage_s3_region
      label: AWS S3 Region
      defaultValue: us-east-1
    - id: $$cap_app_storage_s3_bucket
      label: AWS S3 Bucket Name
    - id: $$cap_app_storage_do_spaces_access_key
      label: DigitalOcean Spaces Access Key
    - id: $$cap_app_storage_do_spaces_secret
      label: DigitalOcean Spaces Secret Key
    - id: $$cap_app_storage_do_spaces_region
      label: DigitalOcean Spaces Region
      defaultValue: us-east-1
    - id: $$cap_app_storage_do_spaces_bucket
      label: DigitalOcean Spaces Bucket Name
    - id: $$cap_app_storage_backblaze_access_key
      label: Backblaze Access Key
    - id: $$cap_app_storage_backblaze_secret
      label: Backblaze Secret Key
    - id: $$cap_app_storage_backblaze_region
      label: Backblaze Region
      defaultValue: us-east-1
    - id: $$cap_app_storage_backblaze_bucket
      label: Backblaze Bucket Name
    - id: $$cap_app_storage_linode_access_key
      label: Linode Access Key
    - id: $$cap_app_storage_linode_secret
      label: Linode Secret Key
    - id: $$cap_app_storage_linode_region
      label: Linode Region
      defaultValue: us-east-1
    - id: $$cap_app_storage_linode_bucket
      label: Linode Bucket Name
    - id: $$cap_app_storage_wasabi_access_key
      label: Wasabi Access Key
    - id: $$cap_app_storage_wasabi_secret
      label: Wasabi Secret Key
    - id: $$cap_app_storage_wasabi_region
      label: Wasabi Region
      defaultValue: us-east-1
    - id: $$cap_app_storage_wasabi_bucket
      label: Wasabi Bucket Name
    - id: $$cap_app_functions_size_limit
      label: Functions Size Limit (bytes)
      defaultValue: "30000000"
    - id: $$cap_app_functions_timeout
      label: Functions Timeout (seconds)
      defaultValue: "900"
    - id: $$cap_app_functions_build_timeout
      label: Functions Build Timeout (seconds)
      defaultValue: "900"
    - id: $$cap_app_functions_cpus
      label: Functions CPU Allocation
    - id: $$cap_app_functions_memory
      label: Functions Memory Allocation
    - id: $$cap_app_functions_runtimes
      label: Available Function Runtimes
      defaultValue: "node-16.0,php-8.0,python-3.9,ruby-3.0"
    - id: $$cap_app_executor_secret
      label: Executor Secret Key
      defaultValue: $$cap_gen_random_hex(32)
      description: Secret key used for executor authentication. Should be random and secure.
    - id: $$cap_app_logging_config
      label: Logging Configuration
    - id: $$cap_app_maintenance_interval
      label: Maintenance Interval (seconds)
      defaultValue: "86400"
    - id: $$cap_app_maintenance_delay
      label: Maintenance Initial Delay (seconds)
      defaultValue: "0"
    - id: $$cap_app_maintenance_retention_execution
      label: Execution Logs Retention (seconds)
      defaultValue: "1209600"
    - id: $$cap_app_maintenance_retention_cache
      label: Cache Retention (seconds)
      defaultValue: "2592000"
    - id: $$cap_app_maintenance_retention_abuse
      label: Abuse Logs Retention (seconds)
      defaultValue: "86400"
    - id: $$cap_app_maintenance_retention_audit
      label: Audit Logs Retention (seconds)
      defaultValue: "1209600"
    - id: $$cap_app_maintenance_retention_usage_hourly
      label: Hourly Usage Logs Retention (seconds)
      defaultValue: "8640000"
    - id: $$cap_app_maintenance_retention_schedules
      label: Schedules Retention (seconds)
      defaultValue: "86400"
    - id: $$cap_app_sms_provider
      label: SMS Provider Name
    - id: $$cap_app_sms_from
      label: SMS From Number
    - id: $$cap_app_graphql_max_batch_size
      label: GraphQL Max Batch Size
      defaultValue: "10"
    - id: $$cap_app_graphql_max_complexity
      label: GraphQL Max Query Complexity
      defaultValue: "250"
    - id: $$cap_app_graphql_max_depth
      label: GraphQL Max Query Depth
      defaultValue: "3"
    - id: $$cap_app_vcs_github_app_name
      label: GitHub App Name
    - id: $$cap_app_vcs_github_private_key
      label: GitHub Private Key
    - id: $$cap_app_vcs_github_app_id
      label: GitHub App ID
    - id: $$cap_app_vcs_github_webhook_secret
      label: GitHub Webhook Secret
    - id: $$cap_app_vcs_github_client_secret
      label: GitHub Client Secret
    - id: $$cap_app_vcs_github_client_id
      label: GitHub Client ID
    - id: $$cap_app_migrations_firebase_client_id
      label: Firebase Client ID
    - id: $$cap_app_migrations_firebase_client_secret
      label: Firebase Client Secret
    - id: $$cap_app_assistant_openai_api_key
      label: OpenAI API Key
    - id: $$cap_appwrite_console_version
      label: Appwrite Console Version
      defaultValue: 5.0.12
      description: Version of the Appwrite Console UI
    - id: $$cap_app_system_security_email_address
      label: Security Email Address
      defaultValue: certs@appwrite.io
    - id: $$cap_app_email_certificates
      label: Email Certificates Path
    - id: $$cap_app_docker_hub_username
      label: Docker Hub Username
      defaultValue: root
    - id: $$cap_app_docker_hub_password
      label: Docker Hub Password
      defaultValue: $$cap_gen_random_hex(32)
    - id: $$cap_app_usage_aggregation_interval
      label: Usage Aggregation Interval (seconds)
      defaultValue: "30"
    - id: $$cap_appwrite_assistant_version
      label: Appwrite Assistant Version
      defaultValue: 0.4.0
      description: Version of the Appwrite Assistant
    - id: $$cap_openruntimes_executor_version
      label: OpenRuntimes Executor Version
      defaultValue: 0.6.11
      description: Version of the OpenRuntimes Executor
    - id: $$cap_mariadb_version
      label: MariaDB Version
      defaultValue: "10.11"
      description: Version of MariaDB to use
    - id: $$cap_mariadb_auto_upgrade
      label: MARIADB_AUTO_UPGRADE
      defaultValue: "1"
    - id: $$cap_redis_version
      label: Redis Version
      defaultValue: 7.2.4-alpine
      description: Version of Redis to use
    - id: $$cap_app_functions_inactive_threshold
      label: Functions Inactive Threshold
      defaultValue: "60"
      description: Time in seconds before an inactive function is terminated
    - id: $$cap_app_functions_maintenance_interval
      label: Functions Maintenance Interval
      defaultValue: "600"
      description: Interval in seconds between function maintenance runs
    - id: $$cap_app_functions_runtimes_network
      label: Functions Runtime Network
      defaultValue: "captain-overlay-network"
      description: Docker network name for function runtimes
services:
  $$cap_appname:
    image: appwrite/appwrite:$$cap_appwrite_appwrite_version
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_LOCALE: $$cap_app_locale
      _APP_CONSOLE_WHITELIST_ROOT: $$cap_app_console_whitelist_root
      _APP_CONSOLE_WHITELIST_EMAILS: $$cap_app_console_whitelist_emails
      _APP_CONSOLE_SESSION_ALERTS: $$cap_app_console_session_alerts
      _APP_CONSOLE_WHITELIST_IPS: $$cap_app_console_whitelist_ips
      _APP_CONSOLE_HOSTNAMES: $$cap_app_console_hostnames
      _APP_SYSTEM_EMAIL_NAME: $$cap_app_system_email_name
      _APP_SYSTEM_EMAIL_ADDRESS: $$cap_app_system_email_address
      _APP_EMAIL_SECURITY: $$cap_app_email_security
      _APP_SYSTEM_RESPONSE_FORMAT: $$cap_app_system_response_format
      _APP_OPTIONS_ABUSE: $$cap_app_options_abuse
      _APP_OPTIONS_ROUTER_PROTECTION: $$cap_app_options_router_protection
      _APP_OPTIONS_FORCE_HTTPS: $$cap_app_options_force_https
      _APP_OPTIONS_FUNCTIONS_FORCE_HTTPS: $$cap_app_options_functions_force_https
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_DOMAIN: $$cap_app_domain
      _APP_DOMAIN_TARGET: $$cap_app_domain_target
      _APP_DOMAIN_FUNCTIONS: $$cap_app_domain_functions
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_SMTP_HOST: $$cap_app_smtp_host
      _APP_SMTP_PORT: $$cap_app_smtp_port
      _APP_SMTP_SECURE: $$cap_app_smtp_secure
      _APP_SMTP_USERNAME: $$cap_app_smtp_username
      _APP_SMTP_PASSWORD: $$cap_app_smtp_password
      _APP_USAGE_STATS: $$cap_app_usage_stats
      _APP_STORAGE_LIMIT: $$cap_app_storage_limit
      _APP_STORAGE_PREVIEW_LIMIT: $$cap_app_storage_preview_limit
      _APP_STORAGE_ANTIVIRUS: $$cap_app_storage_antivirus
      _APP_STORAGE_ANTIVIRUS_HOST: $$cap_app_storage_antivirus_host
      _APP_STORAGE_ANTIVIRUS_PORT: $$cap_app_storage_antivirus_port
      _APP_STORAGE_DEVICE: $$cap_app_storage_device
      _APP_STORAGE_S3_ACCESS_KEY: $$cap_app_storage_s3_access_key
      _APP_STORAGE_S3_SECRET: $$cap_app_storage_s3_secret
      _APP_STORAGE_S3_REGION: $$cap_app_storage_s3_region
      _APP_STORAGE_S3_BUCKET: $$cap_app_storage_s3_bucket
      _APP_STORAGE_DO_SPACES_ACCESS_KEY: $$cap_app_storage_do_spaces_access_key
      _APP_STORAGE_DO_SPACES_SECRET: $$cap_app_storage_do_spaces_secret
      _APP_STORAGE_DO_SPACES_REGION: $$cap_app_storage_do_spaces_region
      _APP_STORAGE_DO_SPACES_BUCKET: $$cap_app_storage_do_spaces_bucket
      _APP_STORAGE_BACKBLAZE_ACCESS_KEY: $$cap_app_storage_backblaze_access_key
      _APP_STORAGE_BACKBLAZE_SECRET: $$cap_app_storage_backblaze_secret
      _APP_STORAGE_BACKBLAZE_REGION: $$cap_app_storage_backblaze_region
      _APP_STORAGE_BACKBLAZE_BUCKET: $$cap_app_storage_backblaze_bucket
      _APP_STORAGE_LINODE_ACCESS_KEY: $$cap_app_storage_linode_access_key
      _APP_STORAGE_LINODE_SECRET: $$cap_app_storage_linode_secret
      _APP_STORAGE_LINODE_REGION: $$cap_app_storage_linode_region
      _APP_STORAGE_LINODE_BUCKET: $$cap_app_storage_linode_bucket
      _APP_STORAGE_WASABI_ACCESS_KEY: $$cap_app_storage_wasabi_access_key
      _APP_STORAGE_WASABI_SECRET: $$cap_app_storage_wasabi_secret
      _APP_STORAGE_WASABI_REGION: $$cap_app_storage_wasabi_region
      _APP_STORAGE_WASABI_BUCKET: $$cap_app_storage_wasabi_bucket
      _APP_FUNCTIONS_SIZE_LIMIT: $$cap_app_functions_size_limit
      _APP_FUNCTIONS_TIMEOUT: $$cap_app_functions_timeout
      _APP_FUNCTIONS_BUILD_TIMEOUT: $$cap_app_functions_build_timeout
      _APP_FUNCTIONS_CPUS: $$cap_app_functions_cpus
      _APP_FUNCTIONS_MEMORY: $$cap_app_functions_memory
      _APP_FUNCTIONS_RUNTIMES: $$cap_app_functions_runtimes
      _APP_EXECUTOR_SECRET: $$cap_app_executor_secret
      _APP_EXECUTOR_HOST: http://srv-captain--$$cap_appname-openruntimes-executor/v1
      _APP_LOGGING_CONFIG: $$cap_app_logging_config
      _APP_MAINTENANCE_INTERVAL: $$cap_app_maintenance_interval
      _APP_MAINTENANCE_DELAY: $$cap_app_maintenance_delay
      _APP_MAINTENANCE_RETENTION_EXECUTION: $$cap_app_maintenance_retention_execution
      _APP_MAINTENANCE_RETENTION_CACHE: $$cap_app_maintenance_retention_cache
      _APP_MAINTENANCE_RETENTION_ABUSE: $$cap_app_maintenance_retention_abuse
      _APP_MAINTENANCE_RETENTION_AUDIT: $$cap_app_maintenance_retention_audit
      _APP_MAINTENANCE_RETENTION_USAGE_HOURLY: $$cap_app_maintenance_retention_usage_hourly
      _APP_MAINTENANCE_RETENTION_SCHEDULES: $$cap_app_maintenance_retention_schedules
      _APP_SMS_PROVIDER: $$cap_app_sms_provider
      _APP_SMS_FROM: $$cap_app_sms_from
      _APP_GRAPHQL_MAX_BATCH_SIZE: $$cap_app_graphql_max_batch_size
      _APP_GRAPHQL_MAX_COMPLEXITY: $$cap_app_graphql_max_complexity
      _APP_GRAPHQL_MAX_DEPTH: $$cap_app_graphql_max_depth
      _APP_VCS_GITHUB_APP_NAME: $$cap_app_vcs_github_app_name
      _APP_VCS_GITHUB_PRIVATE_KEY: $$cap_app_vcs_github_private_key
      _APP_VCS_GITHUB_APP_ID: $$cap_app_vcs_github_app_id
      _APP_VCS_GITHUB_WEBHOOK_SECRET: $$cap_app_vcs_github_webhook_secret
      _APP_VCS_GITHUB_CLIENT_SECRET: $$cap_app_vcs_github_client_secret
      _APP_VCS_GITHUB_CLIENT_ID: $$cap_app_vcs_github_client_id
      _APP_MIGRATIONS_FIREBASE_CLIENT_ID: $$cap_app_migrations_firebase_client_id
      _APP_MIGRATIONS_FIREBASE_CLIENT_SECRET: $$cap_app_migrations_firebase_client_secret
      _APP_ASSISTANT_OPENAI_API_KEY: $$cap_app_assistant_openai_api_key
    volumes:
      - $$cap_appname-uploads:/storage/uploads:rw
      - $$cap_appname-cache:/storage/cache:rw
      - $$cap_appname-config:/storage/config:rw
      - $$cap_appname-certificates:/storage/certificates:rw
      - $$cap_appname-functions:/storage/functions:rw
    caproverExtra:
      notExposeAsWebApp: false
      containerHttpPort: 80
      websocketSupport: true
    depends_on:
      - $$cap_appname-mariadb
      - $$cap_appname-redis
  $$cap_appname-console:
    image: appwrite/console:$$cap_appwrite_console_version
    caproverExtra:
      notExposeAsWebApp: true
  $$cap_appname-realtime:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPTIONS_ABUSE: $$cap_app_options_abuse
      _APP_OPTIONS_ROUTER_PROTECTION: $$cap_app_options_router_protection
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_USAGE_STATS: $$cap_app_usage_stats
      _APP_LOGGING_CONFIG: $$cap_app_logging_config
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["realtime"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-mariadb
      - $$cap_appname-redis
  $$cap_appname-worker-audits:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_LOGGING_CONFIG: $$cap_app_logging_config
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["worker-audits"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-redis
      - $$cap_appname-mariadb
  $$cap_appname-worker-webhooks:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_EMAIL_SECURITY: $$cap_app_email_security
      _APP_SYSTEM_SECURITY_EMAIL_ADDRESS: $$cap_app_system_security_email_address
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_LOGGING_CONFIG: $$cap_app_logging_config
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["worker-webhooks"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-redis
      - $$cap_appname-mariadb
  $$cap_appname-worker-deletes:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_STORAGE_DEVICE: $$cap_app_storage_device
      _APP_STORAGE_S3_ACCESS_KEY: $$cap_app_storage_s3_access_key
      _APP_STORAGE_S3_SECRET: $$cap_app_storage_s3_secret
      _APP_STORAGE_S3_REGION: $$cap_app_storage_s3_region
      _APP_STORAGE_S3_BUCKET: $$cap_app_storage_s3_bucket
      _APP_STORAGE_DO_SPACES_ACCESS_KEY: $$cap_app_storage_do_spaces_access_key
      _APP_STORAGE_DO_SPACES_SECRET: $$cap_app_storage_do_spaces_secret
      _APP_STORAGE_DO_SPACES_REGION: $$cap_app_storage_do_spaces_region
      _APP_STORAGE_DO_SPACES_BUCKET: $$cap_app_storage_do_spaces_bucket
      _APP_STORAGE_BACKBLAZE_ACCESS_KEY: $$cap_app_storage_backblaze_access_key
      _APP_STORAGE_BACKBLAZE_SECRET: $$cap_app_storage_backblaze_secret
      _APP_STORAGE_BACKBLAZE_REGION: $$cap_app_storage_backblaze_region
      _APP_STORAGE_BACKBLAZE_BUCKET: $$cap_app_storage_backblaze_bucket
      _APP_STORAGE_LINODE_ACCESS_KEY: $$cap_app_storage_linode_access_key
      _APP_STORAGE_LINODE_SECRET: $$cap_app_storage_linode_secret
      _APP_STORAGE_LINODE_REGION: $$cap_app_storage_linode_region
      _APP_STORAGE_LINODE_BUCKET: $$cap_app_storage_linode_bucket
      _APP_STORAGE_WASABI_ACCESS_KEY: $$cap_app_storage_wasabi_access_key
      _APP_STORAGE_WASABI_SECRET: $$cap_app_storage_wasabi_secret
      _APP_STORAGE_WASABI_REGION: $$cap_app_storage_wasabi_region
      _APP_STORAGE_WASABI_BUCKET: $$cap_app_storage_wasabi_bucket
      _APP_LOGGING_CONFIG: $$cap_app_logging_config
      _APP_EXECUTOR_SECRET: $$cap_app_executor_secret
      _APP_EXECUTOR_HOST: http://srv-captain--$$cap_appname-openruntimes-executor/v1
      _APP_MAINTENANCE_RETENTION_ABUSE: $$cap_app_maintenance_retention_abuse
      _APP_MAINTENANCE_RETENTION_AUDIT: $$cap_app_maintenance_retention_audit
      _APP_MAINTENANCE_RETENTION_EXECUTION: $$cap_app_maintenance_retention_execution
    volumes:
      - $$cap_appname-uploads:/storage/uploads:rw
      - $$cap_appname-cache:/storage/cache:rw
      - $$cap_appname-functions:/storage/functions:rw
      - $$cap_appname-builds:/storage/builds:rw
      - $$cap_appname-certificates:/storage/certificates:rw
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["worker-deletes"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-redis
      - $$cap_appname-mariadb
  $$cap_appname-worker-databases:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_LOGGING_CONFIG: $$cap_app_logging_config
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["worker-databases"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-redis
      - $$cap_appname-mariadb
  $$cap_appname-worker-builds:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_EXECUTOR_SECRET: $$cap_app_executor_secret
      _APP_EXECUTOR_HOST: http://srv-captain--$$cap_appname-openruntimes-executor/v1
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_LOGGING_CONFIG: $$cap_app_logging_config
      _APP_VCS_GITHUB_APP_NAME: $$cap_app_vcs_github_app_name
      _APP_VCS_GITHUB_PRIVATE_KEY: $$cap_app_vcs_github_private_key
      _APP_VCS_GITHUB_APP_ID: $$cap_app_vcs_github_app_id
      _APP_FUNCTIONS_TIMEOUT: $$cap_app_functions_timeout
      _APP_FUNCTIONS_BUILD_TIMEOUT: $$cap_app_functions_build_timeout
      _APP_FUNCTIONS_CPUS: $$cap_app_functions_cpus
      _APP_FUNCTIONS_MEMORY: $$cap_app_functions_memory
      _APP_FUNCTIONS_SIZE_LIMIT: $$cap_app_functions_size_limit
      _APP_OPTIONS_FORCE_HTTPS: $$cap_app_options_force_https
      _APP_OPTIONS_FUNCTIONS_FORCE_HTTPS: $$cap_app_options_functions_force_https
      _APP_DOMAIN: $$cap_app_domain
      _APP_STORAGE_DEVICE: $$cap_app_storage_device
      _APP_STORAGE_S3_ACCESS_KEY: $$cap_app_storage_s3_access_key
      _APP_STORAGE_S3_SECRET: $$cap_app_storage_s3_secret
      _APP_STORAGE_S3_REGION: $$cap_app_storage_s3_region
      _APP_STORAGE_S3_BUCKET: $$cap_app_storage_s3_bucket
      _APP_STORAGE_DO_SPACES_ACCESS_KEY: $$cap_app_storage_do_spaces_access_key
      _APP_STORAGE_DO_SPACES_SECRET: $$cap_app_storage_do_spaces_secret
      _APP_STORAGE_DO_SPACES_REGION: $$cap_app_storage_do_spaces_region
      _APP_STORAGE_DO_SPACES_BUCKET: $$cap_app_storage_do_spaces_bucket
      _APP_STORAGE_BACKBLAZE_ACCESS_KEY: $$cap_app_storage_backblaze_access_key
      _APP_STORAGE_BACKBLAZE_SECRET: $$cap_app_storage_backblaze_secret
      _APP_STORAGE_BACKBLAZE_REGION: $$cap_app_storage_backblaze_region
      _APP_STORAGE_BACKBLAZE_BUCKET: $$cap_app_storage_backblaze_bucket
      _APP_STORAGE_LINODE_ACCESS_KEY: $$cap_app_storage_linode_access_key
      _APP_STORAGE_LINODE_SECRET: $$cap_app_storage_linode_secret
      _APP_STORAGE_LINODE_REGION: $$cap_app_storage_linode_region
      _APP_STORAGE_LINODE_BUCKET: $$cap_app_storage_linode_bucket
      _APP_STORAGE_WASABI_ACCESS_KEY: $$cap_app_storage_wasabi_access_key
      _APP_STORAGE_WASABI_SECRET: $$cap_app_storage_wasabi_secret
      _APP_STORAGE_WASABI_REGION: $$cap_app_storage_wasabi_region
      _APP_STORAGE_WASABI_BUCKET: $$cap_app_storage_wasabi_bucket
    volumes:
      - $$cap_appname-functions:/storage/functions:rw
      - $$cap_appname-builds:/storage/builds:rw
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["worker-builds"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-redis
      - $$cap_appname-mariadb
  $$cap_appname-worker-certificates:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_DOMAIN: $$cap_app_domain
      _APP_DOMAIN_TARGET: $$cap_app_domain_target
      _APP_DOMAIN_FUNCTIONS: $$cap_app_domain_functions
      _APP_EMAIL_CERTIFICATES: $$cap_app_email_certificates
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_LOGGING_CONFIG: $$cap_app_logging_config
    volumes:
      - $$cap_appname-config:/storage/config:rw
      - $$cap_appname-certificates:/storage/certificates:rw
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["worker-certificates"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-redis
      - $$cap_appname-mariadb
  $$cap_appname-worker-functions:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_DOMAIN: $$cap_app_domain
      _APP_OPTIONS_FORCE_HTTPS: $$cap_app_options_force_https
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_FUNCTIONS_TIMEOUT: $$cap_app_functions_timeout
      _APP_FUNCTIONS_BUILD_TIMEOUT: $$cap_app_functions_build_timeout
      _APP_FUNCTIONS_CPUS: $$cap_app_functions_cpus
      _APP_FUNCTIONS_MEMORY: $$cap_app_functions_memory
      _APP_EXECUTOR_SECRET: $$cap_app_executor_secret
      _APP_EXECUTOR_HOST: http://srv-captain--$$cap_appname-openruntimes-executor/v1
      _APP_USAGE_STATS: $$cap_app_usage_stats
      _APP_DOCKER_HUB_USERNAME: $$cap_app_docker_hub_username
      _APP_DOCKER_HUB_PASSWORD: $$cap_app_docker_hub_password
      _APP_LOGGING_CONFIG: $$cap_app_logging_config
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["worker-functions"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-redis
      - $$cap_appname-mariadb
      - $$cap_appname-openruntimes-executor
  $$cap_appname-worker-mails:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_SYSTEM_EMAIL_NAME: $$cap_app_system_email_name
      _APP_SYSTEM_EMAIL_ADDRESS: $$cap_app_system_email_address
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_SMTP_HOST: $$cap_app_smtp_host
      _APP_SMTP_PORT: $$cap_app_smtp_port
      _APP_SMTP_SECURE: $$cap_app_smtp_secure
      _APP_SMTP_USERNAME: $$cap_app_smtp_username
      _APP_SMTP_PASSWORD: $$cap_app_smtp_password
      _APP_LOGGING_CONFIG: $$cap_app_logging_config
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["worker-mails"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-redis
  $$cap_appname-worker-messaging:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_LOGGING_CONFIG: $$cap_app_logging_config
      _APP_SMS_FROM: $$cap_app_sms_from
      _APP_SMS_PROVIDER: $$cap_app_sms_provider
      _APP_STORAGE_DEVICE: $$cap_app_storage_device
      _APP_STORAGE_S3_ACCESS_KEY: $$cap_app_storage_s3_access_key
      _APP_STORAGE_S3_SECRET: $$cap_app_storage_s3_secret
      _APP_STORAGE_S3_REGION: $$cap_app_storage_s3_region
      _APP_STORAGE_S3_BUCKET: $$cap_app_storage_s3_bucket
      _APP_STORAGE_DO_SPACES_ACCESS_KEY: $$cap_app_storage_do_spaces_access_key
      _APP_STORAGE_DO_SPACES_SECRET: $$cap_app_storage_do_spaces_secret
      _APP_STORAGE_DO_SPACES_REGION: $$cap_app_storage_do_spaces_region
      _APP_STORAGE_DO_SPACES_BUCKET: $$cap_app_storage_do_spaces_bucket
      _APP_STORAGE_BACKBLAZE_ACCESS_KEY: $$cap_app_storage_backblaze_access_key
      _APP_STORAGE_BACKBLAZE_SECRET: $$cap_app_storage_backblaze_secret
      _APP_STORAGE_BACKBLAZE_REGION: $$cap_app_storage_backblaze_region
      _APP_STORAGE_BACKBLAZE_BUCKET: $$cap_app_storage_backblaze_bucket
      _APP_STORAGE_LINODE_ACCESS_KEY: $$cap_app_storage_linode_access_key
      _APP_STORAGE_LINODE_SECRET: $$cap_app_storage_linode_secret
      _APP_STORAGE_LINODE_REGION: $$cap_app_storage_linode_region
      _APP_STORAGE_LINODE_BUCKET: $$cap_app_storage_linode_bucket
      _APP_STORAGE_WASABI_ACCESS_KEY: $$cap_app_storage_wasabi_access_key
      _APP_STORAGE_WASABI_SECRET: $$cap_app_storage_wasabi_secret
      _APP_STORAGE_WASABI_REGION: $$cap_app_storage_wasabi_region
      _APP_STORAGE_WASABI_BUCKET: $$cap_app_storage_wasabi_bucket
    volumes:
      - $$cap_appname-uploads:/storage/uploads:rw
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["worker-messaging"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-redis
  $$cap_appname-worker-migrations:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_DOMAIN: $$cap_app_domain
      _APP_DOMAIN_TARGET: $$cap_app_domain_target
      _APP_EMAIL_SECURITY: $$cap_app_email_security
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_LOGGING_CONFIG: $$cap_app_logging_config
      _APP_MIGRATIONS_FIREBASE_CLIENT_ID: $$cap_app_migrations_firebase_client_id
      _APP_MIGRATIONS_FIREBASE_CLIENT_SECRET: $$cap_app_migrations_firebase_client_secret
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["worker-migrations"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-mariadb
  $$cap_appname-task-maintenance:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_DOMAIN: $$cap_app_domain
      _APP_DOMAIN_TARGET: $$cap_app_domain_target
      _APP_DOMAIN_FUNCTIONS: $$cap_app_domain_functions
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_MAINTENANCE_INTERVAL: $$cap_app_maintenance_interval
      _APP_MAINTENANCE_RETENTION_EXECUTION: $$cap_app_maintenance_retention_execution
      _APP_MAINTENANCE_RETENTION_CACHE: $$cap_app_maintenance_retention_cache
      _APP_MAINTENANCE_RETENTION_ABUSE: $$cap_app_maintenance_retention_abuse
      _APP_MAINTENANCE_RETENTION_AUDIT: $$cap_app_maintenance_retention_audit
      _APP_MAINTENANCE_RETENTION_USAGE_HOURLY: $$cap_app_maintenance_retention_usage_hourly
      _APP_MAINTENANCE_RETENTION_SCHEDULES: $$cap_app_maintenance_retention_schedules
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["maintenance"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-redis
  $$cap_appname-worker-usage:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_USAGE_STATS: $$cap_app_usage_stats
      _APP_LOGGING_CONFIG: $$cap_app_logging_config
      _APP_USAGE_AGGREGATION_INTERVAL: $$cap_app_usage_aggregation_interval
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["worker-usage"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-redis
      - $$cap_appname-mariadb
  $$cap_appname-worker-usage-dump:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_USAGE_STATS: $$cap_app_usage_stats
      _APP_LOGGING_CONFIG: $$cap_app_logging_config
      _APP_USAGE_AGGREGATION_INTERVAL: $$cap_app_usage_aggregation_interval
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["worker-usage-dump"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-redis
      - $$cap_appname-mariadb
  $$cap_appname-task-scheduler-functions:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["schedule-functions"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-mariadb
      - $$cap_appname-redis
  $$cap_appname-task-scheduler-executions:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["schedule-executions"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-mariadb
      - $$cap_appname-redis
  $$cap_appname-task-scheduler-messages:
    environment:
      _APP_ENV: $$cap_app_env
      _APP_WORKER_PER_CORE: $$cap_app_worker_per_core
      _APP_OPENSSL_KEY_V1: $$cap_app_openssl_key_v1
      _APP_REDIS_HOST: srv-captain--$$cap_appname-redis
      _APP_REDIS_PORT: "6379"
      _APP_REDIS_USER: $$cap_app_redis_user
      _APP_REDIS_PASS: $$cap_app_redis_pass
      _APP_DB_HOST: srv-captain--$$cap_appname-mariadb
      _APP_DB_PORT: "3306"
      _APP_DB_SCHEMA: $$cap_app_db_schema
      _APP_DB_USER: $$cap_app_db_user
      _APP_DB_PASS: $$cap_app_db_pass
    caproverExtra:
      dockerfileLines:
        - FROM appwrite/appwrite:$$cap_appwrite_appwrite_version
        - ENTRYPOINT ["schedule-messages"]
      notExposeAsWebApp: true
    depends_on:
      - $$cap_appname-mariadb
      - $$cap_appname-redis
  $$cap_appname-assistant:
    image: appwrite/assistant:$$cap_appwrite_assistant_version
    environment:
      _APP_ASSISTANT_OPENAI_API_KEY: $$cap_app_assistant_openai_api_key
    caproverExtra:
      notExposeAsWebApp: true
  $$cap_appname-openruntimes-executor:
    image: openruntimes/executor:$$cap_openruntimes_executor_version
    environment:
      OPR_EXECUTOR_INACTIVE_TRESHOLD: $$cap_app_functions_inactive_threshold
      OPR_EXECUTOR_MAINTENANCE_INTERVAL: $$cap_app_functions_maintenance_interval
      OPR_EXECUTOR_NETWORK: $$cap_app_functions_runtimes_network
      OPR_EXECUTOR_DOCKER_HUB_USERNAME: $$cap_app_docker_hub_username
      OPR_EXECUTOR_DOCKER_HUB_PASSWORD: $$cap_app_docker_hub_password
      OPR_EXECUTOR_ENV: $$cap_app_env
      OPR_EXECUTOR_RUNTIMES: $$cap_app_functions_runtimes
      OPR_EXECUTOR_SECRET: $$cap_app_executor_secret
      OPR_EXECUTOR_LOGGING_CONFIG: $$cap_app_logging_config
      OPR_EXECUTOR_STORAGE_DEVICE: $$cap_app_storage_device
      OPR_EXECUTOR_STORAGE_S3_ACCESS_KEY: $$cap_app_storage_s3_access_key
      OPR_EXECUTOR_STORAGE_S3_SECRET: $$cap_app_storage_s3_secret
      OPR_EXECUTOR_STORAGE_S3_REGION: $$cap_app_storage_s3_region
      OPR_EXECUTOR_STORAGE_S3_BUCKET: $$cap_app_storage_s3_bucket
      OPR_EXECUTOR_STORAGE_DO_SPACES_ACCESS_KEY: $$cap_app_storage_do_spaces_access_key
      OPR_EXECUTOR_STORAGE_DO_SPACES_SECRET: $$cap_app_storage_do_spaces_secret
      OPR_EXECUTOR_STORAGE_DO_SPACES_REGION: $$cap_app_storage_do_spaces_region
      OPR_EXECUTOR_STORAGE_DO_SPACES_BUCKET: $$cap_app_storage_do_spaces_bucket
      OPR_EXECUTOR_STORAGE_BACKBLAZE_ACCESS_KEY: $$cap_app_storage_backblaze_access_key
      OPR_EXECUTOR_STORAGE_BACKBLAZE_SECRET: $$cap_app_storage_backblaze_secret
      OPR_EXECUTOR_STORAGE_BACKBLAZE_REGION: $$cap_app_storage_backblaze_region
      OPR_EXECUTOR_STORAGE_BACKBLAZE_BUCKET: $$cap_app_storage_backblaze_bucket
      OPR_EXECUTOR_STORAGE_LINODE_ACCESS_KEY: $$cap_app_storage_linode_access_key
      OPR_EXECUTOR_STORAGE_LINODE_SECRET: $$cap_app_storage_linode_secret
      OPR_EXECUTOR_STORAGE_LINODE_REGION: $$cap_app_storage_linode_region
      OPR_EXECUTOR_STORAGE_LINODE_BUCKET: $$cap_app_storage_linode_bucket
      OPR_EXECUTOR_STORAGE_WASABI_ACCESS_KEY: $$cap_app_storage_wasabi_access_key
      OPR_EXECUTOR_STORAGE_WASABI_SECRET: $$cap_app_storage_wasabi_secret
      OPR_EXECUTOR_STORAGE_WASABI_REGION: $$cap_app_storage_wasabi_region
      OPR_EXECUTOR_STORAGE_WASABI_BUCKET: $$cap_app_storage_wasabi_bucket
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - $$cap_appname-builds:/storage/builds:rw
      - $$cap_appname-functions:/storage/functions:rw
      - /tmp:/tmp:rw
    caproverExtra:
      notExposeAsWebApp: true
  $$cap_appname-mariadb:
    environment:
      MYSQL_ROOT_PASSWORD: $$cap_app_db_pass
      MYSQL_DATABASE: $$cap_app_db_schema
      MYSQL_USER: $$cap_app_db_user
      MYSQL_PASSWORD: $$cap_app_db_pass
      MARIADB_AUTO_UPGRADE: $$cap_mariadb_auto_upgrade
    volumes:
      - $$cap_appname-mariadb:/var/lib/mysql:rw
    caproverExtra:
      notExposeAsWebApp: true
      dockerfileLines:
        - FROM mariadb:$$cap_mariadb_version
        - CMD ["--innodb-flush-method", "fsync"]
  $$cap_appname-redis:
    image: redis:$$cap_redis_version
    command: >
      redis-server --maxmemory            512mb
      --maxmemory-policy     allkeys-lru --maxmemory-samples    5
    volumes:
      - $$cap_appname-redis:/data:rw
    caproverExtra:
      notExposeAsWebApp: true
